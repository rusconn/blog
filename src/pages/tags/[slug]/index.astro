---
import { getCollection } from "astro:content";

import PostsNav, { type Props as PostsNavProps } from "@/components/PostsNav.astro";
import { TAGS } from "@/constants";
import Layout from "@/layout/Layout.astro";

type ParamsProps = {
  params: { slug: string };
  props: Props;
}[];

type Props = {
  name: string;
  posts: PostsNavProps["posts"];
};

export async function getStaticPaths(): Promise<ParamsProps> {
  const allPosts = await getCollection("posts");

  return TAGS.map(({ slug, name }) => ({
    params: { slug },
    props: {
      name,
      posts: allPosts
        .filter(({ data }) => (data.tags as string[]).includes(slug))
        .map(({ data: { title, date }, slug }) => ({ title, date, slug })),
    },
  }));
}

const { name, posts } = Astro.props;

const title = `${name}の記事`;
const description = `${name}の記事`;
---

<Layout {...{ title, description }}>
  <PostsNav heading={`${name}の記事`} {...{ posts }} />
</Layout>
